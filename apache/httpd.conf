ServerName localhost

LoadModule authn_file_module modules/mod_authn_file.so
LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule headers_module modules/mod_headers.so

User daemon
Group daemon

ServerAdmin you@example.com
ServerTokens Prod
ServerSignature Off

<IfModule mpm_event_module>
    StartServers             2
    MinSpareThreads         25
    MaxSpareThreads         75
    ThreadLimit             64
    ThreadsPerChild         25
    MaxRequestWorkers      150
    MaxConnectionsPerChild   0
</IfModule>

Timeout 60
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5

LogFormat "%h %l %u %t \"%r\" %>s %b" common
CustomLog logs/access.log common
ErrorLog  logs/error.log

# Basic Auth applied at the top-level
<Location />
  AuthType Basic
  AuthName "Restricted"
  AuthUserFile "/usr/local/apache2/conf/.htpasswd"
  Require valid-user
</Location>

# Reverse proxy to frontend and backend based on path
ProxyPreserveHost On
ProxyRequests Off

# Frontend at /
ProxyPass        / http://web:3000/
ProxyPassReverse / http://web:3000/

# Backend API at /api
ProxyPass        /api http://backend:3000/api
ProxyPassReverse /api http://backend:3000/api

# Files
ProxyPass        /files http://backend:3000/files
ProxyPassReverse /files http://backend:3000/files

Header always set X-Content-Type-Options "nosniff"
Header always set X-Frame-Options "SAMEORIGIN"
Header always set X-XSS-Protection "1; mode=block"


